{"title":"Site Reliability Analysis in Hypertension Treatment Clinical Trial","markdown":{"yaml":{"title":"Site Reliability Analysis in Hypertension Treatment Clinical Trial","author":"Prince Agyapong","date":"today","format":{"html":{"theme":"yeti","toc":true,"toc-depth":4,"toc-location":"left","number-sections":false,"code-fold":true,"code-summary":"Show Code","df-print":"paged","smooth-scroll":true,"link-external-icon":true,"link-external-newwindow":true}},"editor":"visual"},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n\nThis project explores site-level reliability using a synthetic dataset modeled after a Phase III randomized controlled trial evaluating the efficacy of a hypertension treatment (CardioX) compared to an active comparator and placebo. The dataset includes 1,000 patients enrolled across 50 trial sites, with comprehensive data on demographics, blood pressure, cholesterol levels, dropout rates, and adverse events. The dataset used in this project is publicly available on [Kaggle](https://www.kaggle.com/datasets/isabelladil/phase-iii-clinical-trial-dataset/data).\n\n### Analysis\n\n### Rates and Ranks\n\nTo begin the assessment of site reliability, average rates or values were calculated for each risk factor at every clinical trial site. These included the average dropout rate, adverse event (AE) rate, and average measurements of systolic blood pressure, diastolic blood pressure, and cholesterol level.\n\n```{r,  warning=FALSE, message=FALSE}\n#| label: load-packages\n#| include: false\n# Load required packages\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(dplyr, tidyr, ggplot2, readr, mixtools, readr, purrr,\n               cluster, gt, patchwork)\n\n# Read data\ndf <- read_csv('/Users/prince/Downloads/synthetic_clinical_trial_data.csv')\n\n# Summarize metrics by site\nsite_summary <- df %>%\n  group_by(Site_ID) %>%\n  summarise(\n    Dropout_Rate = mean(Dropout, na.rm = TRUE),\n    AE_Rate = mean(Adverse_Events, na.rm = TRUE),\n    Systolic_Mean = mean(Systolic_BP, na.rm = TRUE),\n    Diastolic_Mean = mean(Diastolic_BP, na.rm = TRUE),\n    Cholesterol_Mean = mean(Cholesterol_Level, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\nsite_summary\n```\n\nEach site was ranked based on its performance across the selected risk factors. Rankings were assigned in descending order so that sites with better performance (lower risk) received higher rank values, and sites with poorer performance (higher risk) received lower rank values. Tied values were given the average of their ranks. The ranking process was applied separately for dropout rate, adverse event rate, average systolic blood pressure, average diastolic blood pressure, and average cholesterol level.\n\n```{r}\n# Rank each metric\nsite_ranked <- site_summary %>%\n  mutate(\n    Dropout_Rank = rank(-Dropout_Rate, ties.method = \"average\", na.last = \"keep\"),\n    AE_Rank = rank(-AE_Rate, ties.method = \"average\", na.last = \"keep\"),\n    Systolic_Rank = rank(-Systolic_Mean, ties.method = \"average\", na.last = \"keep\"),\n    Diastolic_Rank = rank(-Diastolic_Mean, ties.method = \"average\", na.last = \"keep\"),\n    Cholesterol_Rank = rank(-Cholesterol_Mean, ties.method = \"average\", na.last = \"keep\")\n  )\n\n# Convert to long format\nrank_long <- site_ranked %>%\n  select(Site_ID, ends_with(\"_Rank\")) %>%\n  pivot_longer(\n    cols = ends_with(\"_Rank\"),\n    names_to = \"RF\",\n    values_to = \"Rank_Value\"\n  ) %>%\n  mutate(\n    RF = case_when(\n      RF == \"Dropout_Rank\" ~ \"Dropout Rate\",\n      RF == \"AE_Rank\" ~ \"Adverse Event Rate\",\n      RF == \"Systolic_Rank\" ~ \"Average Systolic BP\",\n      RF == \"Diastolic_Rank\" ~ \"Average Diastolic BP\",\n      RF == \"Cholesterol_Rank\" ~ \"Average Cholesterol Level\",\n      TRUE ~ RF\n    )\n  )\n\nrank_long\n```\n\nAn overall rank was calculated for each site by averaging its ranks across all five risk factors. This average rank provides a composite indicator of site performance, allowing for a unified comparison of site-level data quality and reliability.\n\n```{r}\n# Compute average rank per site\navg_rank <- rank_long %>%\n  group_by(Site_ID) %>%\n  summarise(Rank_Value = mean(Rank_Value, na.rm = TRUE), .groups = \"drop\")\n\navg_rank\n```\n\n### K-means Clustering\n\nTo determine the optimal number of site clusters, the average silhouette width was calculated for K values ranging from 2 to 10. The silhouette method evaluates how well each site fits within its assigned cluster, with higher values indicating better cohesion and separation. The plot showed that $K=3$ yielded the highest average silhouette width, suggesting three distinct clusters best represent the variation in average site ranks.\n\n```{r}\n# K means clustering \nset.seed(117)\n# Function to calculate average silhouette width\ncalculate_silhouette <- function(k) {\n  kmeans_result <- kmeans(avg_rank$Rank_Value, centers = k, nstart = 10)\n  sil <- silhouette(kmeans_result$cluster, dist(avg_rank$Rank_Value))\n  mean(sil[, \"sil_width\"])\n}\n\n# Compute silhouette scores for k = 2 to 10\nk_values <- 2:10\nsilhouette_scores <- sapply(k_values, calculate_silhouette)\n\n# Create a data frame for plotting\nsil_df <- data.frame(\n  K = k_values,\n  Silhouette = silhouette_scores\n)\n\n# Plot using ggplot2\nggplot(sil_df, aes(x = K, y = Silhouette)) +\n  geom_line(linewidth = 1) +\n  geom_point(color = \"red\", size = 3) +\n  labs(\n    title = \"Silhouette Plot: Optimal Number of Clusters\",\n    x = \"Number of Clusters (K)\",\n    y = \"Average Silhouette Width\"\n  ) +\n  scale_x_continuous(breaks = 2:10) +\n  theme_bw()\n\n```\n\n```{r, warning=FALSE, message=FALSE}\n# Run k-means\nkmeans_result <- kmeans(avg_rank$Rank_Value, centers = 3, nstart = 10)\n\n# Create a lookup table for cluster centers and risk labels\ncluster_labels <- tibble(\n  cluster = 1:3,\n  center = as.numeric(kmeans_result$centers)) %>%\n  arrange(desc(center)) %>%\n  mutate(site_risk = c(\"Low\", \"Medium\", \"High\"))\n\n# Attach cluster and site_risk to avg_rank\navg_rank <- avg_rank %>%\n  mutate(cluster = kmeans_result$cluster) %>%\n  left_join(cluster_labels, by = \"cluster\")  \n\np <- ggplot(avg_rank, aes(x = Rank_Value, fill = factor(site_risk, levels = c(\"Low\", \"Medium\", \"High\")))) +\n  geom_histogram(binwidth = 2, alpha = 0.6, color = \"black\") +\n  geom_vline(data = cluster_labels, aes(xintercept = center), \n             linetype = \"dashed\", color = \"black\", size = 1) +\n  scale_fill_manual(values = c(\"High\" = \"red\", \"Medium\" = \"blue\", \"Low\" = \"forestgreen\")) +\n  labs(title = \"K-Means Clustering on Average Rank\",\n       x = \"Average Rank Value\",\n       y = \"Number of Sites\",\n       fill = \"Site Risk\") +\n  theme_bw() +\n  theme(legend.position = \"bottom\")\n\n```\n\nSites were clustered using k-means based on their average rank across risk factors, where higher ranks indicate better site performance. After clustering, risk labels were assigned in descending order of the cluster centers: the cluster with the highest average rank was labeled Low risk, followed by Medium, and the cluster with the lowest average rank labeled High risk.\n\nThus, Low-risk sites had the highest average ranks, suggesting consistently favorable performance across the ranked metrics. In contrast, High-risk sites had the lowest average ranks, indicating potential concerns such as underreporting, protocol non-adherence, or other data integrity issues\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n#| fig-cap: \"Histogram of average site rankings. Dashed vertical lines indicate k-means cluster centers used to assign site risk levels (Low, Medium, High).\"\np\n```\n\n```{r}\ndf_with_risk <- df |>\n  left_join(avg_rank |>\n              select(Site_ID, site_risk),\n            by = \"Site_ID\") \n\nrates_dat <- site_summary |>\n  left_join(avg_rank |>\n              select(site_risk, Site_ID),\n            by = \"Site_ID\") |>\n  pivot_longer(cols = 2:6,\n               names_to = \"RF\",\n               values_to = \"Value\") |>\n  mutate(RF = case_when(\n    RF == \"Dropout_Rate\" ~ \"Dropout Rate\",\n    RF == \"AE_Rate\" ~ \"Adverse Event Rate\",\n    RF == \"Systolic_Mean\" ~ \"Average Systolic BP\",\n    RF == \"Diastolic_Mean\" ~ \"Average Diastolic BP\",\n    RF == \"Cholesterol_Mean\" ~ \"Average Cholesterol Level\",\n    TRUE ~ RF\n  )) |> \n  mutate(site_risk = factor(site_risk, levels = c(\"Low\", \"Medium\", \"High\")))\n  \n\n# Density Plots \n\ndensity_plots <- rates_dat %>%\n  split(.$RF) %>%\n  map(~ ggplot(.x, aes(x = Value, fill = site_risk)) +\n        geom_density(alpha = 0.3, color = NA) +\n        scale_fill_manual(values = c(\n          \"High\" = \"red\", \"Medium\" = \"blue\", \"Low\" = \"forestgreen\"   \n        )) +\n        labs(\n          x = unique(.x$RF),\n          y = \"Density\",\n          fill = \"Site Risk\"\n        ) +\n        theme_bw() +\n        theme(\n          legend.position = \"bottom\",\n          legend.title = element_text(size = 14, face = \"bold\"),\n          legend.text = element_text(size = 12),\n          axis.text = element_text(size = 12, face = \"bold\"),\n          axis.title = element_text(size = 14, face = \"bold\"),\n          plot.title = element_blank()\n        )\n  ) \n\n```\n\n### Distributional Analysis of Data Anomalies Using Risk Factors\n\n**1. Dropout Rate**\n\nSites classified as high risk exhibit higher dropout rates than those categorized as medium or low risk. This trend may reflect challenges related to participant engagement or site operations, potentially impacting retention and overall study quality.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Dropout Rate\"]]\n```\n\n**2. Adverse Event Rate**\n\nAdverse event rates are skewed higher for high risk sites, with some reporting unusually elevated rates. This could point to over-reporting, inconsistent AE definitions, or poor protocol adherence, which are often signs of unreliable data.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Adverse Event Rate\"]]\n```\n\n**3. Average Systolic BP**\n\nHigh-risk sites report higher and more variable average systolic blood pressure levels. Although elevated BP is expected in this population, the degree of variation and inflation at high-risk sites may suggest inadequate blood pressure control, protocol non-adherence, or measurement inconsistencies. In contrast, lower-risk sites show more consistent and moderate readings, suggesting more reliable data capture.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Average Systolic BP\"]]\n```\n\n**4. Average Diastolic BP**\n\nHigh-risk sites report higher and more variable average diastolic blood pressure readings. This wider spread may indicate inconsistent measurement techniques, protocol deviations, or site-level data quality concerns, similar to the systolic BP findings.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Average Diastolic BP\"]]\n```\n\n**5. Average Cholesterol Level**\n\nCholesterol levels appear elevated and right-shifted at high-risk sites compared to others. This pattern may indicate potential lab calibration issues, data entry errors, or differences in patient selection, such as enrolling individuals with higher baseline cardiovascular risk.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Average Cholesterol Level\"]]\n```\n\n```{r, warning=FALSE, message=FALSE, echo = F}\nsummary_statistics <- function(dsin,\n                               numvars,\n                               charvars = NULL,\n                               by = NULL,\n                               group = NULL,\n                               mean_diffs = FALSE,\n                               ci_diffs = FALSE,\n                               pval_diffs = FALSE,\n                               overall = FALSE,\n                               fisher = FALSE,\n                               digits_mean_sd = 2,\n                               digits_median = 2,\n                               digits_q1_q3 = 2,\n                               digits_min_max = 2,\n                               digits_diff_mean = 2,\n                               digits_diff_ci = 2,\n                               digits_diff_pval = 3,\n                               welch = FALSE) {\n  \n  group_vars <- c(by, group)\n\n  # Character Summary \n  char_summary <- NULL\n  if (!is.null(charvars)) {\n    char_summary <- dsin %>%\n      tidyr::pivot_longer(cols = all_of(charvars), names_to = \"charvar\", values_to = \"level\") %>%\n      dplyr::group_by(dplyr::across(all_of(group_vars)), charvar, level) %>%\n      dplyr::summarise(n = dplyr::n(), .groups = \"drop\") %>%\n      dplyr::group_by(dplyr::across(all_of(group_vars)), charvar) %>%\n      dplyr::mutate(prop = sprintf(\"%d (%.0f%%)\", n, 100 * n / sum(n))) %>%\n      dplyr::ungroup()\n\n    char_summary <- if (!is.null(group)) {\n      char_summary %>%\n        dplyr::transmute(\n          !!by := !!rlang::sym(by),\n          VARIABLE = charvar,\n          STAT = level,\n          VALUE = prop,\n          STATORD = 1,\n          VARTYPE = \"character\",\n          !!group := !!rlang::sym(group)\n        )\n    } else {\n      char_summary %>%\n        dplyr::transmute(\n          !!by := !!rlang::sym(by),\n          VARIABLE = charvar,\n          STAT = level,\n          VALUE = prop,\n          STATORD = 1,\n          VARTYPE = \"character\"\n        )\n    }\n\n    if (fisher && !is.null(by) && !is.null(group)) {\n      fisher_pvals <- purrr::map_dfr(charvars, function(var) {\n        tbl <- table(dsin[[var]], dsin[[group]])\n        pval <- if (all(dim(tbl) > 1)) fisher.test(tbl)$p.value else NA\n        tibble::tibble(\n          !!by := unique(dsin[[by]]),\n          VARIABLE = var,\n          STAT = \"Fisher P-value\",\n          STATORD = 2,\n          VARTYPE = \"character\",\n          VALUE = format.pval(pval, digits = digits_diff_pval, eps = 0.001)\n        )\n      })\n      if (overall) {\n        fisher_pvals <- fisher_pvals %>% dplyr::mutate(Overall = VALUE) %>% dplyr::select(-VALUE)\n      } else if (!is.null(group)) {\n        fisher_pvals <- fisher_pvals %>% dplyr::mutate(!!group := NA_character_)\n      }\n      char_summary <- dplyr::bind_rows(char_summary, fisher_pvals)\n    }\n  }\n\n  summarize_numeric <- function(data, var) {\n    v <- data[[var]]\n    tibble::tibble(\n      `N` = as.character(sum(!is.na(v))),\n      `Mean (SD)` = sprintf(paste0(\"%.\", digits_mean_sd, \"f (%.\", digits_mean_sd, \"f)\"),\n                            mean(v, na.rm = TRUE), sd(v, na.rm = TRUE)),\n      `Median` = sprintf(paste0(\"%.\", digits_median, \"f\"), median(v, na.rm = TRUE)),\n      `(Q1, Q3)` = sprintf(paste0(\"%.\", digits_q1_q3, \"f, %.\", digits_q1_q3, \"f\"),\n                           quantile(v, 0.25, na.rm = TRUE),\n                           quantile(v, 0.75, na.rm = TRUE)),\n      `Min, Max` = sprintf(paste0(\"%.\", digits_min_max, \"f, %.\", digits_min_max, \"f\"),\n                           min(v, na.rm = TRUE), max(v, na.rm = TRUE))\n    )\n  }\n\n  numeric_summary <- purrr::map_dfr(numvars, function(var) {\n    dsin %>%\n      dplyr::group_by(dplyr::across(all_of(group_vars))) %>%\n      dplyr::summarise(out = list(summarize_numeric(cur_data(), var)), .groups = \"drop\") %>%\n      tidyr::unnest(out) %>%\n      tidyr::pivot_longer(cols = c(\"N\", \"Mean (SD)\", \"Median\", \"(Q1, Q3)\", \"Min, Max\"),\n                          names_to = \"STAT\", values_to = \"VALUE\") %>%\n      dplyr::mutate(\n        !!by := !!rlang::sym(by),\n        VARIABLE = var,\n        STATORD = match(STAT, c(\"N\", \"Mean (SD)\", \"Median\", \"(Q1, Q3)\", \"Min, Max\")),\n        VARTYPE = \"numeric\"\n      )\n  })\n\n  all_summary <- dplyr::bind_rows(char_summary, numeric_summary)\n\n  if (!is.null(group)) {\n    all_summary <- all_summary %>%\n      tidyr::pivot_wider(names_from = all_of(group), values_from = VALUE)\n  }\n\n  if (!is.null(group) && overall) {\n    overall_summary <- summary_statistics(\n      dsin = dsin,\n      numvars = numvars,\n      charvars = charvars,\n      by = by,\n      group = NULL,\n      mean_diffs = FALSE,\n      ci_diffs = FALSE,\n      pval_diffs = FALSE,\n      overall = FALSE\n    ) %>%\n      dplyr::mutate(Overall = VALUE) %>% dplyr::select(-VALUE)\n\n    all_summary <- dplyr::left_join(\n      all_summary,\n      overall_summary,\n      by = c(by, \"STAT\", \"VARIABLE\", \"STATORD\", \"VARTYPE\")\n    ) %>%\n      dplyr::mutate(Overall = dplyr::coalesce(!!!dplyr::select(., dplyr::starts_with(\"Overall\")))) %>%\n      dplyr::select(-dplyr::starts_with(\"overall.\"))\n  }\n\n  if (mean_diffs && !is.null(group)) {\n    levels <- levels(factor(dsin[[group]]))\n    diff_results <- purrr::map_dfr(numvars, function(var) {\n      tmp <- dsin %>% dplyr::filter(!is.na(.data[[var]]))\n      if (length(levels) == 2) {\n        test <- t.test(as.formula(paste(var, \"~\", group)), data = tmp, var.equal = !welch)\n        lv <- levels\n        diff_val <- test$estimate[2] - test$estimate[1]\n        tibble::tibble(\n          !!by := unique(tmp[[by]]),\n          VARIABLE = var,\n          STAT = c(\"Mean Difference\", \"95% CI of Difference\", \"Difference p-value\"),\n          STATORD = c(6, 7, 8),\n          VARTYPE = \"numeric\",\n          !!lv[1] := NA,\n          !!lv[2] := c(\n            sprintf(paste0(\"%.\", digits_diff_mean, \"f (%.\", digits_diff_mean, \"f)\"),\n                    diff_val, test$stderr),\n            sprintf(paste0(\"%.\", digits_diff_ci, \"f, %.\", digits_diff_ci, \"f\"),\n                    test$conf.int[1], test$conf.int[2]),\n            if (test$p.value < 0.001) \"<0.001\" else sprintf(paste0(\"%.\", digits_diff_pval, \"f\"), test$p.value)\n          )\n        )\n      } else {\n        combs <- combn(levels, 2, simplify = FALSE)\n        purrr::map_dfr(combs, function(lv) {\n          subset <- tmp %>% dplyr::filter(.data[[group]] %in% lv)\n          test <- t.test(as.formula(paste(var, \"~\", group)), data = subset, var.equal = !welch)\n          stat <- sprintf(\"Mean Difference (%s - %s)\", lv[2], lv[1])\n          diff_val <- test$estimate[[lv[2]]] - test$estimate[[lv[1]]]\n          val <- sprintf(paste0(\"%.\", digits_diff_mean, \"f (%.\", digits_diff_mean, \"f)\"),\n                         diff_val, test$stderr)\n          ci <- sprintf(paste0(\"%.\", digits_diff_ci, \"f, %.\", digits_diff_ci, \"f\"),\n                        test$conf.int[1], test$conf.int[2])\n          pval <- if (test$p.value < 0.001) \"<0.001\" else sprintf(paste0(\"%.\", digits_diff_pval, \"f\"), test$p.value)\n          tibble::tibble(\n            !!by := unique(subset[[by]]),\n            VARIABLE = var,\n            STAT = c(stat, paste0(\"95% CI of \", stat), paste0(\"P-value of \", stat)),\n            STATORD = 10,\n            VARTYPE = \"numeric\",\n            !!lv[1] := NA_character_,\n            !!lv[2] := c(val, ci, pval)\n          )\n        })\n      }\n    })\n    all_summary <- dplyr::bind_rows(all_summary, diff_results) \n  }\n\n  return(all_summary %>% dplyr::arrange(VARTYPE, VARIABLE, STATORD) %>%\n           dplyr::mutate(across(where(is.character), ~ if_else(is.na(.x), \"\", .x))))\n}\n\nrfs_data <- rank_long |>\n  left_join(avg_rank |>\n              select(site_risk, Site_ID),\n            by = \"Site_ID\")\n```\n\n### Summary Statistics of Risk Factors\n\n**High vs Low**\n\nLow-risk sites had significantly higher rank values than high-risk sites for systolic blood pressure (mean difference = 24.83, p \\< 0.001) and adverse event rate (mean difference = 19.79, p \\< 0.001). These large and statistically significant differences suggest that low-risk sites are much more consistent in their reporting of expected clinical patterns or completeness. The lower ranks at high-risk sites point to potential underreporting or data quality issues that may compromise the reliability of the information collected at those locations.\n\n```{r, warning=FALSE, message=FALSE}\n\n# Create summary tables for  risk factor (RF)\n# comparisons across site risk groups: High vs Low, Medium vs Low, High vs Medium\n# Risk factors: High vs Low\nrfs <- unique(rfs_data$RF)\n\nhl_rfs <- map2_dfr(\n  rfs,\n  seq_along(rfs),\n  function(rf, i) {\n    tbl <- summary_statistics(\n      dsin = rfs_data |> \n        filter(RF == rf, site_risk %in% c(\"High\", \"Low\")) |> \n        mutate(site_risk = factor(site_risk, levels = c(\"High\", \"Low\"))),\n      numvars = \"Rank_Value\",\n      by = \"RF\",\n      group = \"site_risk\",\n      mean_diffs = TRUE,\n      ci_diffs = TRUE,\n      pval_diffs = TRUE,\n      overall = FALSE\n    ) |>\n      mutate(RF = if_else(STAT == \"N\", RF, \"\")) |>\n      select(-c(VARIABLE, VARTYPE, STATORD))\n    \n    if (i < length(rfs)) {\n      blank_row <- tbl[1, ] |> mutate(across(everything(), ~ \"\"))\n      bind_rows(tbl, blank_row)\n    } else {\n      tbl\n    }\n  }\n)\n\nhl_rfs |> \n  gt() |> \n  cols_label(\n    STAT = \"Statistic\",\n    RF = \"Risk Factor\",\n    Low = \"Low Risk\",\n    High = \"High Risk\"\n  ) |> \n  tab_caption(\"Comparison of Summary Statistics for Low and High Risk Sites\") |>\n  opt_table_font(font = list(gt::google_font(\"Roboto Condensed\"), default_fonts())) |>\n  opt_table_outline() |>\n  opt_row_striping() |>\n  tab_options(\n    table.font.size = px(14),\n    data_row.padding = px(4),\n    heading.title.font.size = px(16),\n    column_labels.font.weight = \"bold\",\n    column_labels.background.color = \"skyblue\"\n  )\n```\n\n**Medium vs Low**\n\nSystolic blood pressure (mean difference = 16.14, p = 0.001) and dropout rate (mean difference = 12.08, p = 0.015) ranked significantly higher at low-risk sites than at medium-risk sites. This indicates that low-risk sites again show greater data completeness or capture clinical variation more accurately. Medium-risk sites may fall somewhere in between, with more plausible values than high-risk sites but still some signs of inconsistency or incompleteness.\n\n```{r, warning=FALSE, message=FALSE}\n\n# Risk factors: Medium vs Low\nml_rfs <- map2_dfr(\n  rfs,\n  seq_along(rfs),\n  function(rf, i) {\n    tbl <- summary_statistics(\n      dsin = rfs_data |> \n        filter(RF == rf, site_risk %in% c(\"Medium\", \"Low\")) |> \n        mutate(site_risk = factor(site_risk, levels = c(\"Medium\", \"Low\"))),\n      numvars = \"Rank_Value\",\n      by = \"RF\",\n      group = \"site_risk\",\n      mean_diffs = TRUE,\n      ci_diffs = TRUE,\n      pval_diffs = TRUE,\n      overall = FALSE\n    ) |>\n      mutate(RF = if_else(STAT == \"N\", RF, \"\")) |>\n      select(-c(VARIABLE, VARTYPE, STATORD))\n    \n    if (i < length(rfs)) {\n      blank_row <- tbl[1, ] |> mutate(across(everything(), ~ \"\"))\n      bind_rows(tbl, blank_row)\n    } else {\n      tbl\n    }\n  }\n)\n\nml_rfs |> \n  gt() |> \n  cols_label(\n    STAT = \"Statistic\",\n    RF = \"Risk Factor\",\n    Low = \"Low Risk\",\n    Medium = \"Medium Risk\"\n  ) |> \n  tab_caption(\"Comparison of Summary Statistics for Low and Medium Risk Sites\") |>\n  opt_table_font(font = list(gt::google_font(\"Roboto Condensed\"), default_fonts())) |>\n  opt_table_outline() |>\n  opt_row_striping() |>\n  tab_options(\n    table.font.size = px(14),\n    data_row.padding = px(4),\n    heading.title.font.size = px(16),\n    column_labels.font.weight = \"bold\",\n    column_labels.background.color = \"skyblue\"\n  )\n```\n\n**Medium vs High**\n\nAdverse event rate had a significant mean difference in ranks between medium-risk and high-risk sites (11.76, p = 0.017), favoring medium-risk sites. Although the differences in systolic and diastolic blood pressure ranks (8.69 and 7.73, respectively) were not statistically significant, they still suggest a trend toward more complete reporting at medium-risk sites compared to high-risk ones.\n\n```{r, warning=FALSE, message=FALSE}\n# Risk factors: High vs Medium\nmh_rfs <- map2_dfr(\n  rfs,\n  seq_along(rfs),\n  function(rf, i) {\n    tbl <- summary_statistics(\n      dsin = rfs_data |> \n        filter(RF == rf, site_risk %in% c(\"High\", \"Medium\")) |> \n        mutate(site_risk = factor(site_risk, levels = c(\"High\", \"Medium\"))),\n      numvars = \"Rank_Value\",\n      by = \"RF\",\n      group = \"site_risk\",\n      mean_diffs = TRUE,\n      ci_diffs = TRUE,\n      pval_diffs = TRUE,\n      overall = FALSE\n    ) |>\n      mutate(RF = if_else(STAT == \"N\", RF, \"\")) |>\n      select(-c(VARIABLE, VARTYPE, STATORD))\n    \n    if (i < length(rfs)) {\n      blank_row <- tbl[1, ] |> mutate(across(everything(), ~ \"\"))\n      bind_rows(tbl, blank_row)\n    } else {\n      tbl\n    }\n  }\n)\n\n\nmh_rfs |>\n  gt() |>\n  cols_label(\n    STAT = \"Statistic\",\n    RF = \"Risk Factor\",\n    High = \"High Risk\",\n    Medium = \"Medium Risk\"\n  ) |>\n  tab_caption(\"Comparison of Summary Statistics for Medium and High Risk Sites\") |>\n  opt_table_font(font = list(gt::google_font(\"Roboto Condensed\"), default_fonts())) |>\n  opt_table_outline() |>\n  opt_row_striping() |>\n  tab_options(\n    table.font.size = px(14),\n    data_row.padding = px(4),\n    heading.title.font.size = px(16),\n    column_labels.font.weight = \"bold\",\n    column_labels.background.color = \"skyblue\"\n  )\n```\n\n### Conclusion\n\nThe rank-based analysis demonstrates that low-risk sites consistently outperformed others in terms of data quality, achieving notably higher ranks across key clinical metrics. Medium-risk sites also performed better than high-risk sites, especially in the reporting of adverse events. These findings support the validity of the site classification and suggest that high-risk sites may be affected by protocol deviations, underreporting, or other operational issues that compromise data reliability.\n\n### Recommendations\n\n-   **Targeted monitoring** should be considered for high-risk sites to investigate possible causes of poor data quality.\n-   **Site retraining or audits** may help reinforce protocol adherence and improve reporting accuracy.\n-   **Continuous rank-based surveillance** can be incorporated into risk-based monitoring workflows to proactively flag emerging issues.\n-   **Further investigation** into operational challenges at high-risk sites may offer insights to prevent similar issues in future trials.\n","srcMarkdownNoYaml":"\n\n### Introduction\n\nThis project explores site-level reliability using a synthetic dataset modeled after a Phase III randomized controlled trial evaluating the efficacy of a hypertension treatment (CardioX) compared to an active comparator and placebo. The dataset includes 1,000 patients enrolled across 50 trial sites, with comprehensive data on demographics, blood pressure, cholesterol levels, dropout rates, and adverse events. The dataset used in this project is publicly available on [Kaggle](https://www.kaggle.com/datasets/isabelladil/phase-iii-clinical-trial-dataset/data).\n\n### Analysis\n\n### Rates and Ranks\n\nTo begin the assessment of site reliability, average rates or values were calculated for each risk factor at every clinical trial site. These included the average dropout rate, adverse event (AE) rate, and average measurements of systolic blood pressure, diastolic blood pressure, and cholesterol level.\n\n```{r,  warning=FALSE, message=FALSE}\n#| label: load-packages\n#| include: false\n# Load required packages\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(dplyr, tidyr, ggplot2, readr, mixtools, readr, purrr,\n               cluster, gt, patchwork)\n\n# Read data\ndf <- read_csv('/Users/prince/Downloads/synthetic_clinical_trial_data.csv')\n\n# Summarize metrics by site\nsite_summary <- df %>%\n  group_by(Site_ID) %>%\n  summarise(\n    Dropout_Rate = mean(Dropout, na.rm = TRUE),\n    AE_Rate = mean(Adverse_Events, na.rm = TRUE),\n    Systolic_Mean = mean(Systolic_BP, na.rm = TRUE),\n    Diastolic_Mean = mean(Diastolic_BP, na.rm = TRUE),\n    Cholesterol_Mean = mean(Cholesterol_Level, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\nsite_summary\n```\n\nEach site was ranked based on its performance across the selected risk factors. Rankings were assigned in descending order so that sites with better performance (lower risk) received higher rank values, and sites with poorer performance (higher risk) received lower rank values. Tied values were given the average of their ranks. The ranking process was applied separately for dropout rate, adverse event rate, average systolic blood pressure, average diastolic blood pressure, and average cholesterol level.\n\n```{r}\n# Rank each metric\nsite_ranked <- site_summary %>%\n  mutate(\n    Dropout_Rank = rank(-Dropout_Rate, ties.method = \"average\", na.last = \"keep\"),\n    AE_Rank = rank(-AE_Rate, ties.method = \"average\", na.last = \"keep\"),\n    Systolic_Rank = rank(-Systolic_Mean, ties.method = \"average\", na.last = \"keep\"),\n    Diastolic_Rank = rank(-Diastolic_Mean, ties.method = \"average\", na.last = \"keep\"),\n    Cholesterol_Rank = rank(-Cholesterol_Mean, ties.method = \"average\", na.last = \"keep\")\n  )\n\n# Convert to long format\nrank_long <- site_ranked %>%\n  select(Site_ID, ends_with(\"_Rank\")) %>%\n  pivot_longer(\n    cols = ends_with(\"_Rank\"),\n    names_to = \"RF\",\n    values_to = \"Rank_Value\"\n  ) %>%\n  mutate(\n    RF = case_when(\n      RF == \"Dropout_Rank\" ~ \"Dropout Rate\",\n      RF == \"AE_Rank\" ~ \"Adverse Event Rate\",\n      RF == \"Systolic_Rank\" ~ \"Average Systolic BP\",\n      RF == \"Diastolic_Rank\" ~ \"Average Diastolic BP\",\n      RF == \"Cholesterol_Rank\" ~ \"Average Cholesterol Level\",\n      TRUE ~ RF\n    )\n  )\n\nrank_long\n```\n\nAn overall rank was calculated for each site by averaging its ranks across all five risk factors. This average rank provides a composite indicator of site performance, allowing for a unified comparison of site-level data quality and reliability.\n\n```{r}\n# Compute average rank per site\navg_rank <- rank_long %>%\n  group_by(Site_ID) %>%\n  summarise(Rank_Value = mean(Rank_Value, na.rm = TRUE), .groups = \"drop\")\n\navg_rank\n```\n\n### K-means Clustering\n\nTo determine the optimal number of site clusters, the average silhouette width was calculated for K values ranging from 2 to 10. The silhouette method evaluates how well each site fits within its assigned cluster, with higher values indicating better cohesion and separation. The plot showed that $K=3$ yielded the highest average silhouette width, suggesting three distinct clusters best represent the variation in average site ranks.\n\n```{r}\n# K means clustering \nset.seed(117)\n# Function to calculate average silhouette width\ncalculate_silhouette <- function(k) {\n  kmeans_result <- kmeans(avg_rank$Rank_Value, centers = k, nstart = 10)\n  sil <- silhouette(kmeans_result$cluster, dist(avg_rank$Rank_Value))\n  mean(sil[, \"sil_width\"])\n}\n\n# Compute silhouette scores for k = 2 to 10\nk_values <- 2:10\nsilhouette_scores <- sapply(k_values, calculate_silhouette)\n\n# Create a data frame for plotting\nsil_df <- data.frame(\n  K = k_values,\n  Silhouette = silhouette_scores\n)\n\n# Plot using ggplot2\nggplot(sil_df, aes(x = K, y = Silhouette)) +\n  geom_line(linewidth = 1) +\n  geom_point(color = \"red\", size = 3) +\n  labs(\n    title = \"Silhouette Plot: Optimal Number of Clusters\",\n    x = \"Number of Clusters (K)\",\n    y = \"Average Silhouette Width\"\n  ) +\n  scale_x_continuous(breaks = 2:10) +\n  theme_bw()\n\n```\n\n```{r, warning=FALSE, message=FALSE}\n# Run k-means\nkmeans_result <- kmeans(avg_rank$Rank_Value, centers = 3, nstart = 10)\n\n# Create a lookup table for cluster centers and risk labels\ncluster_labels <- tibble(\n  cluster = 1:3,\n  center = as.numeric(kmeans_result$centers)) %>%\n  arrange(desc(center)) %>%\n  mutate(site_risk = c(\"Low\", \"Medium\", \"High\"))\n\n# Attach cluster and site_risk to avg_rank\navg_rank <- avg_rank %>%\n  mutate(cluster = kmeans_result$cluster) %>%\n  left_join(cluster_labels, by = \"cluster\")  \n\np <- ggplot(avg_rank, aes(x = Rank_Value, fill = factor(site_risk, levels = c(\"Low\", \"Medium\", \"High\")))) +\n  geom_histogram(binwidth = 2, alpha = 0.6, color = \"black\") +\n  geom_vline(data = cluster_labels, aes(xintercept = center), \n             linetype = \"dashed\", color = \"black\", size = 1) +\n  scale_fill_manual(values = c(\"High\" = \"red\", \"Medium\" = \"blue\", \"Low\" = \"forestgreen\")) +\n  labs(title = \"K-Means Clustering on Average Rank\",\n       x = \"Average Rank Value\",\n       y = \"Number of Sites\",\n       fill = \"Site Risk\") +\n  theme_bw() +\n  theme(legend.position = \"bottom\")\n\n```\n\nSites were clustered using k-means based on their average rank across risk factors, where higher ranks indicate better site performance. After clustering, risk labels were assigned in descending order of the cluster centers: the cluster with the highest average rank was labeled Low risk, followed by Medium, and the cluster with the lowest average rank labeled High risk.\n\nThus, Low-risk sites had the highest average ranks, suggesting consistently favorable performance across the ranked metrics. In contrast, High-risk sites had the lowest average ranks, indicating potential concerns such as underreporting, protocol non-adherence, or other data integrity issues\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\n#| fig-cap: \"Histogram of average site rankings. Dashed vertical lines indicate k-means cluster centers used to assign site risk levels (Low, Medium, High).\"\np\n```\n\n```{r}\ndf_with_risk <- df |>\n  left_join(avg_rank |>\n              select(Site_ID, site_risk),\n            by = \"Site_ID\") \n\nrates_dat <- site_summary |>\n  left_join(avg_rank |>\n              select(site_risk, Site_ID),\n            by = \"Site_ID\") |>\n  pivot_longer(cols = 2:6,\n               names_to = \"RF\",\n               values_to = \"Value\") |>\n  mutate(RF = case_when(\n    RF == \"Dropout_Rate\" ~ \"Dropout Rate\",\n    RF == \"AE_Rate\" ~ \"Adverse Event Rate\",\n    RF == \"Systolic_Mean\" ~ \"Average Systolic BP\",\n    RF == \"Diastolic_Mean\" ~ \"Average Diastolic BP\",\n    RF == \"Cholesterol_Mean\" ~ \"Average Cholesterol Level\",\n    TRUE ~ RF\n  )) |> \n  mutate(site_risk = factor(site_risk, levels = c(\"Low\", \"Medium\", \"High\")))\n  \n\n# Density Plots \n\ndensity_plots <- rates_dat %>%\n  split(.$RF) %>%\n  map(~ ggplot(.x, aes(x = Value, fill = site_risk)) +\n        geom_density(alpha = 0.3, color = NA) +\n        scale_fill_manual(values = c(\n          \"High\" = \"red\", \"Medium\" = \"blue\", \"Low\" = \"forestgreen\"   \n        )) +\n        labs(\n          x = unique(.x$RF),\n          y = \"Density\",\n          fill = \"Site Risk\"\n        ) +\n        theme_bw() +\n        theme(\n          legend.position = \"bottom\",\n          legend.title = element_text(size = 14, face = \"bold\"),\n          legend.text = element_text(size = 12),\n          axis.text = element_text(size = 12, face = \"bold\"),\n          axis.title = element_text(size = 14, face = \"bold\"),\n          plot.title = element_blank()\n        )\n  ) \n\n```\n\n### Distributional Analysis of Data Anomalies Using Risk Factors\n\n**1. Dropout Rate**\n\nSites classified as high risk exhibit higher dropout rates than those categorized as medium or low risk. This trend may reflect challenges related to participant engagement or site operations, potentially impacting retention and overall study quality.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Dropout Rate\"]]\n```\n\n**2. Adverse Event Rate**\n\nAdverse event rates are skewed higher for high risk sites, with some reporting unusually elevated rates. This could point to over-reporting, inconsistent AE definitions, or poor protocol adherence, which are often signs of unreliable data.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Adverse Event Rate\"]]\n```\n\n**3. Average Systolic BP**\n\nHigh-risk sites report higher and more variable average systolic blood pressure levels. Although elevated BP is expected in this population, the degree of variation and inflation at high-risk sites may suggest inadequate blood pressure control, protocol non-adherence, or measurement inconsistencies. In contrast, lower-risk sites show more consistent and moderate readings, suggesting more reliable data capture.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Average Systolic BP\"]]\n```\n\n**4. Average Diastolic BP**\n\nHigh-risk sites report higher and more variable average diastolic blood pressure readings. This wider spread may indicate inconsistent measurement techniques, protocol deviations, or site-level data quality concerns, similar to the systolic BP findings.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Average Diastolic BP\"]]\n```\n\n**5. Average Cholesterol Level**\n\nCholesterol levels appear elevated and right-shifted at high-risk sites compared to others. This pattern may indicate potential lab calibration issues, data entry errors, or differences in patient selection, such as enrolling individuals with higher baseline cardiovascular risk.\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\ndensity_plots[[\"Average Cholesterol Level\"]]\n```\n\n```{r, warning=FALSE, message=FALSE, echo = F}\nsummary_statistics <- function(dsin,\n                               numvars,\n                               charvars = NULL,\n                               by = NULL,\n                               group = NULL,\n                               mean_diffs = FALSE,\n                               ci_diffs = FALSE,\n                               pval_diffs = FALSE,\n                               overall = FALSE,\n                               fisher = FALSE,\n                               digits_mean_sd = 2,\n                               digits_median = 2,\n                               digits_q1_q3 = 2,\n                               digits_min_max = 2,\n                               digits_diff_mean = 2,\n                               digits_diff_ci = 2,\n                               digits_diff_pval = 3,\n                               welch = FALSE) {\n  \n  group_vars <- c(by, group)\n\n  # Character Summary \n  char_summary <- NULL\n  if (!is.null(charvars)) {\n    char_summary <- dsin %>%\n      tidyr::pivot_longer(cols = all_of(charvars), names_to = \"charvar\", values_to = \"level\") %>%\n      dplyr::group_by(dplyr::across(all_of(group_vars)), charvar, level) %>%\n      dplyr::summarise(n = dplyr::n(), .groups = \"drop\") %>%\n      dplyr::group_by(dplyr::across(all_of(group_vars)), charvar) %>%\n      dplyr::mutate(prop = sprintf(\"%d (%.0f%%)\", n, 100 * n / sum(n))) %>%\n      dplyr::ungroup()\n\n    char_summary <- if (!is.null(group)) {\n      char_summary %>%\n        dplyr::transmute(\n          !!by := !!rlang::sym(by),\n          VARIABLE = charvar,\n          STAT = level,\n          VALUE = prop,\n          STATORD = 1,\n          VARTYPE = \"character\",\n          !!group := !!rlang::sym(group)\n        )\n    } else {\n      char_summary %>%\n        dplyr::transmute(\n          !!by := !!rlang::sym(by),\n          VARIABLE = charvar,\n          STAT = level,\n          VALUE = prop,\n          STATORD = 1,\n          VARTYPE = \"character\"\n        )\n    }\n\n    if (fisher && !is.null(by) && !is.null(group)) {\n      fisher_pvals <- purrr::map_dfr(charvars, function(var) {\n        tbl <- table(dsin[[var]], dsin[[group]])\n        pval <- if (all(dim(tbl) > 1)) fisher.test(tbl)$p.value else NA\n        tibble::tibble(\n          !!by := unique(dsin[[by]]),\n          VARIABLE = var,\n          STAT = \"Fisher P-value\",\n          STATORD = 2,\n          VARTYPE = \"character\",\n          VALUE = format.pval(pval, digits = digits_diff_pval, eps = 0.001)\n        )\n      })\n      if (overall) {\n        fisher_pvals <- fisher_pvals %>% dplyr::mutate(Overall = VALUE) %>% dplyr::select(-VALUE)\n      } else if (!is.null(group)) {\n        fisher_pvals <- fisher_pvals %>% dplyr::mutate(!!group := NA_character_)\n      }\n      char_summary <- dplyr::bind_rows(char_summary, fisher_pvals)\n    }\n  }\n\n  summarize_numeric <- function(data, var) {\n    v <- data[[var]]\n    tibble::tibble(\n      `N` = as.character(sum(!is.na(v))),\n      `Mean (SD)` = sprintf(paste0(\"%.\", digits_mean_sd, \"f (%.\", digits_mean_sd, \"f)\"),\n                            mean(v, na.rm = TRUE), sd(v, na.rm = TRUE)),\n      `Median` = sprintf(paste0(\"%.\", digits_median, \"f\"), median(v, na.rm = TRUE)),\n      `(Q1, Q3)` = sprintf(paste0(\"%.\", digits_q1_q3, \"f, %.\", digits_q1_q3, \"f\"),\n                           quantile(v, 0.25, na.rm = TRUE),\n                           quantile(v, 0.75, na.rm = TRUE)),\n      `Min, Max` = sprintf(paste0(\"%.\", digits_min_max, \"f, %.\", digits_min_max, \"f\"),\n                           min(v, na.rm = TRUE), max(v, na.rm = TRUE))\n    )\n  }\n\n  numeric_summary <- purrr::map_dfr(numvars, function(var) {\n    dsin %>%\n      dplyr::group_by(dplyr::across(all_of(group_vars))) %>%\n      dplyr::summarise(out = list(summarize_numeric(cur_data(), var)), .groups = \"drop\") %>%\n      tidyr::unnest(out) %>%\n      tidyr::pivot_longer(cols = c(\"N\", \"Mean (SD)\", \"Median\", \"(Q1, Q3)\", \"Min, Max\"),\n                          names_to = \"STAT\", values_to = \"VALUE\") %>%\n      dplyr::mutate(\n        !!by := !!rlang::sym(by),\n        VARIABLE = var,\n        STATORD = match(STAT, c(\"N\", \"Mean (SD)\", \"Median\", \"(Q1, Q3)\", \"Min, Max\")),\n        VARTYPE = \"numeric\"\n      )\n  })\n\n  all_summary <- dplyr::bind_rows(char_summary, numeric_summary)\n\n  if (!is.null(group)) {\n    all_summary <- all_summary %>%\n      tidyr::pivot_wider(names_from = all_of(group), values_from = VALUE)\n  }\n\n  if (!is.null(group) && overall) {\n    overall_summary <- summary_statistics(\n      dsin = dsin,\n      numvars = numvars,\n      charvars = charvars,\n      by = by,\n      group = NULL,\n      mean_diffs = FALSE,\n      ci_diffs = FALSE,\n      pval_diffs = FALSE,\n      overall = FALSE\n    ) %>%\n      dplyr::mutate(Overall = VALUE) %>% dplyr::select(-VALUE)\n\n    all_summary <- dplyr::left_join(\n      all_summary,\n      overall_summary,\n      by = c(by, \"STAT\", \"VARIABLE\", \"STATORD\", \"VARTYPE\")\n    ) %>%\n      dplyr::mutate(Overall = dplyr::coalesce(!!!dplyr::select(., dplyr::starts_with(\"Overall\")))) %>%\n      dplyr::select(-dplyr::starts_with(\"overall.\"))\n  }\n\n  if (mean_diffs && !is.null(group)) {\n    levels <- levels(factor(dsin[[group]]))\n    diff_results <- purrr::map_dfr(numvars, function(var) {\n      tmp <- dsin %>% dplyr::filter(!is.na(.data[[var]]))\n      if (length(levels) == 2) {\n        test <- t.test(as.formula(paste(var, \"~\", group)), data = tmp, var.equal = !welch)\n        lv <- levels\n        diff_val <- test$estimate[2] - test$estimate[1]\n        tibble::tibble(\n          !!by := unique(tmp[[by]]),\n          VARIABLE = var,\n          STAT = c(\"Mean Difference\", \"95% CI of Difference\", \"Difference p-value\"),\n          STATORD = c(6, 7, 8),\n          VARTYPE = \"numeric\",\n          !!lv[1] := NA,\n          !!lv[2] := c(\n            sprintf(paste0(\"%.\", digits_diff_mean, \"f (%.\", digits_diff_mean, \"f)\"),\n                    diff_val, test$stderr),\n            sprintf(paste0(\"%.\", digits_diff_ci, \"f, %.\", digits_diff_ci, \"f\"),\n                    test$conf.int[1], test$conf.int[2]),\n            if (test$p.value < 0.001) \"<0.001\" else sprintf(paste0(\"%.\", digits_diff_pval, \"f\"), test$p.value)\n          )\n        )\n      } else {\n        combs <- combn(levels, 2, simplify = FALSE)\n        purrr::map_dfr(combs, function(lv) {\n          subset <- tmp %>% dplyr::filter(.data[[group]] %in% lv)\n          test <- t.test(as.formula(paste(var, \"~\", group)), data = subset, var.equal = !welch)\n          stat <- sprintf(\"Mean Difference (%s - %s)\", lv[2], lv[1])\n          diff_val <- test$estimate[[lv[2]]] - test$estimate[[lv[1]]]\n          val <- sprintf(paste0(\"%.\", digits_diff_mean, \"f (%.\", digits_diff_mean, \"f)\"),\n                         diff_val, test$stderr)\n          ci <- sprintf(paste0(\"%.\", digits_diff_ci, \"f, %.\", digits_diff_ci, \"f\"),\n                        test$conf.int[1], test$conf.int[2])\n          pval <- if (test$p.value < 0.001) \"<0.001\" else sprintf(paste0(\"%.\", digits_diff_pval, \"f\"), test$p.value)\n          tibble::tibble(\n            !!by := unique(subset[[by]]),\n            VARIABLE = var,\n            STAT = c(stat, paste0(\"95% CI of \", stat), paste0(\"P-value of \", stat)),\n            STATORD = 10,\n            VARTYPE = \"numeric\",\n            !!lv[1] := NA_character_,\n            !!lv[2] := c(val, ci, pval)\n          )\n        })\n      }\n    })\n    all_summary <- dplyr::bind_rows(all_summary, diff_results) \n  }\n\n  return(all_summary %>% dplyr::arrange(VARTYPE, VARIABLE, STATORD) %>%\n           dplyr::mutate(across(where(is.character), ~ if_else(is.na(.x), \"\", .x))))\n}\n\nrfs_data <- rank_long |>\n  left_join(avg_rank |>\n              select(site_risk, Site_ID),\n            by = \"Site_ID\")\n```\n\n### Summary Statistics of Risk Factors\n\n**High vs Low**\n\nLow-risk sites had significantly higher rank values than high-risk sites for systolic blood pressure (mean difference = 24.83, p \\< 0.001) and adverse event rate (mean difference = 19.79, p \\< 0.001). These large and statistically significant differences suggest that low-risk sites are much more consistent in their reporting of expected clinical patterns or completeness. The lower ranks at high-risk sites point to potential underreporting or data quality issues that may compromise the reliability of the information collected at those locations.\n\n```{r, warning=FALSE, message=FALSE}\n\n# Create summary tables for  risk factor (RF)\n# comparisons across site risk groups: High vs Low, Medium vs Low, High vs Medium\n# Risk factors: High vs Low\nrfs <- unique(rfs_data$RF)\n\nhl_rfs <- map2_dfr(\n  rfs,\n  seq_along(rfs),\n  function(rf, i) {\n    tbl <- summary_statistics(\n      dsin = rfs_data |> \n        filter(RF == rf, site_risk %in% c(\"High\", \"Low\")) |> \n        mutate(site_risk = factor(site_risk, levels = c(\"High\", \"Low\"))),\n      numvars = \"Rank_Value\",\n      by = \"RF\",\n      group = \"site_risk\",\n      mean_diffs = TRUE,\n      ci_diffs = TRUE,\n      pval_diffs = TRUE,\n      overall = FALSE\n    ) |>\n      mutate(RF = if_else(STAT == \"N\", RF, \"\")) |>\n      select(-c(VARIABLE, VARTYPE, STATORD))\n    \n    if (i < length(rfs)) {\n      blank_row <- tbl[1, ] |> mutate(across(everything(), ~ \"\"))\n      bind_rows(tbl, blank_row)\n    } else {\n      tbl\n    }\n  }\n)\n\nhl_rfs |> \n  gt() |> \n  cols_label(\n    STAT = \"Statistic\",\n    RF = \"Risk Factor\",\n    Low = \"Low Risk\",\n    High = \"High Risk\"\n  ) |> \n  tab_caption(\"Comparison of Summary Statistics for Low and High Risk Sites\") |>\n  opt_table_font(font = list(gt::google_font(\"Roboto Condensed\"), default_fonts())) |>\n  opt_table_outline() |>\n  opt_row_striping() |>\n  tab_options(\n    table.font.size = px(14),\n    data_row.padding = px(4),\n    heading.title.font.size = px(16),\n    column_labels.font.weight = \"bold\",\n    column_labels.background.color = \"skyblue\"\n  )\n```\n\n**Medium vs Low**\n\nSystolic blood pressure (mean difference = 16.14, p = 0.001) and dropout rate (mean difference = 12.08, p = 0.015) ranked significantly higher at low-risk sites than at medium-risk sites. This indicates that low-risk sites again show greater data completeness or capture clinical variation more accurately. Medium-risk sites may fall somewhere in between, with more plausible values than high-risk sites but still some signs of inconsistency or incompleteness.\n\n```{r, warning=FALSE, message=FALSE}\n\n# Risk factors: Medium vs Low\nml_rfs <- map2_dfr(\n  rfs,\n  seq_along(rfs),\n  function(rf, i) {\n    tbl <- summary_statistics(\n      dsin = rfs_data |> \n        filter(RF == rf, site_risk %in% c(\"Medium\", \"Low\")) |> \n        mutate(site_risk = factor(site_risk, levels = c(\"Medium\", \"Low\"))),\n      numvars = \"Rank_Value\",\n      by = \"RF\",\n      group = \"site_risk\",\n      mean_diffs = TRUE,\n      ci_diffs = TRUE,\n      pval_diffs = TRUE,\n      overall = FALSE\n    ) |>\n      mutate(RF = if_else(STAT == \"N\", RF, \"\")) |>\n      select(-c(VARIABLE, VARTYPE, STATORD))\n    \n    if (i < length(rfs)) {\n      blank_row <- tbl[1, ] |> mutate(across(everything(), ~ \"\"))\n      bind_rows(tbl, blank_row)\n    } else {\n      tbl\n    }\n  }\n)\n\nml_rfs |> \n  gt() |> \n  cols_label(\n    STAT = \"Statistic\",\n    RF = \"Risk Factor\",\n    Low = \"Low Risk\",\n    Medium = \"Medium Risk\"\n  ) |> \n  tab_caption(\"Comparison of Summary Statistics for Low and Medium Risk Sites\") |>\n  opt_table_font(font = list(gt::google_font(\"Roboto Condensed\"), default_fonts())) |>\n  opt_table_outline() |>\n  opt_row_striping() |>\n  tab_options(\n    table.font.size = px(14),\n    data_row.padding = px(4),\n    heading.title.font.size = px(16),\n    column_labels.font.weight = \"bold\",\n    column_labels.background.color = \"skyblue\"\n  )\n```\n\n**Medium vs High**\n\nAdverse event rate had a significant mean difference in ranks between medium-risk and high-risk sites (11.76, p = 0.017), favoring medium-risk sites. Although the differences in systolic and diastolic blood pressure ranks (8.69 and 7.73, respectively) were not statistically significant, they still suggest a trend toward more complete reporting at medium-risk sites compared to high-risk ones.\n\n```{r, warning=FALSE, message=FALSE}\n# Risk factors: High vs Medium\nmh_rfs <- map2_dfr(\n  rfs,\n  seq_along(rfs),\n  function(rf, i) {\n    tbl <- summary_statistics(\n      dsin = rfs_data |> \n        filter(RF == rf, site_risk %in% c(\"High\", \"Medium\")) |> \n        mutate(site_risk = factor(site_risk, levels = c(\"High\", \"Medium\"))),\n      numvars = \"Rank_Value\",\n      by = \"RF\",\n      group = \"site_risk\",\n      mean_diffs = TRUE,\n      ci_diffs = TRUE,\n      pval_diffs = TRUE,\n      overall = FALSE\n    ) |>\n      mutate(RF = if_else(STAT == \"N\", RF, \"\")) |>\n      select(-c(VARIABLE, VARTYPE, STATORD))\n    \n    if (i < length(rfs)) {\n      blank_row <- tbl[1, ] |> mutate(across(everything(), ~ \"\"))\n      bind_rows(tbl, blank_row)\n    } else {\n      tbl\n    }\n  }\n)\n\n\nmh_rfs |>\n  gt() |>\n  cols_label(\n    STAT = \"Statistic\",\n    RF = \"Risk Factor\",\n    High = \"High Risk\",\n    Medium = \"Medium Risk\"\n  ) |>\n  tab_caption(\"Comparison of Summary Statistics for Medium and High Risk Sites\") |>\n  opt_table_font(font = list(gt::google_font(\"Roboto Condensed\"), default_fonts())) |>\n  opt_table_outline() |>\n  opt_row_striping() |>\n  tab_options(\n    table.font.size = px(14),\n    data_row.padding = px(4),\n    heading.title.font.size = px(16),\n    column_labels.font.weight = \"bold\",\n    column_labels.background.color = \"skyblue\"\n  )\n```\n\n### Conclusion\n\nThe rank-based analysis demonstrates that low-risk sites consistently outperformed others in terms of data quality, achieving notably higher ranks across key clinical metrics. Medium-risk sites also performed better than high-risk sites, especially in the reporting of adverse events. These findings support the validity of the site classification and suggest that high-risk sites may be affected by protocol deviations, underreporting, or other operational issues that compromise data reliability.\n\n### Recommendations\n\n-   **Targeted monitoring** should be considered for high-risk sites to investigate possible causes of poor data quality.\n-   **Site retraining or audits** may help reinforce protocol adherence and improve reporting accuracy.\n-   **Continuous rank-based surveillance** can be incorporated into risk-based monitoring workflows to proactively flag emerging issues.\n-   **Further investigation** into operational challenges at high-risk sites may offer insights to prevent similar issues in future trials.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":true,"link-external-newwindow":true,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"toc-depth":4,"number-sections":false,"output-file":"cardiox_site_reliability.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","theme":["cosmo","brand","yeti"],"title":"Site Reliability Analysis in Hypertension Treatment Clinical Trial","author":"Prince Agyapong","date":"today","editor":"visual","toc-location":"left","code-summary":"Show Code","smooth-scroll":true},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}