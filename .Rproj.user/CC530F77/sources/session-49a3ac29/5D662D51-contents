---
title: "Site Reliability Analysis in Hypertension Treatment Clinical Trial"
author: "Prince Agyapong"
date: today
format:  
  html:  
    theme: yeti  
    toc: true 
    toc-depth: 4
    toc-location: left
    number-sections: false
    code-fold: true
    code-summary: "Show Code"
    df-print: paged
    smooth-scroll: true
    link-external-icon: true
    link-external-newwindow: true
editor: visual
---

### Introduction

This project explores site-level reliability using a synthetic dataset modeled after a Phase III randomized controlled trial evaluating the efficacy of a hypertension treatment (CardioX) compared to an active comparator and placebo. The dataset includes 1,000 patients enrolled across 50 trial sites, with comprehensive data on demographics, blood pressure, cholesterol levels, dropout rates, and adverse events. The dataset used in this project is publicly available on [Kaggle](https://www.kaggle.com/datasets/isabelladil/phase-iii-clinical-trial-dataset/data).

### Analysis

### Rates and Ranks

To begin the assessment of site reliability, average rates or values were calculated for each risk factor at every clinical trial site. These included the average dropout rate, adverse event (AE) rate, and average measurements of systolic blood pressure, diastolic blood pressure, and cholesterol level.

```{r,  warning=FALSE, message=FALSE}
#| label: load-packages
#| include: false
# Load required packages
if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, tidyr, ggplot2, readr, mixtools, readr, purrr,
               cluster, gt, patchwork)

# Read data
df <- read_csv('/Users/prince/Downloads/synthetic_clinical_trial_data.csv')

# Summarize metrics by site
site_summary <- df %>%
  group_by(Site_ID) %>%
  summarise(
    Dropout_Rate = mean(Dropout, na.rm = TRUE),
    AE_Rate = mean(Adverse_Events, na.rm = TRUE),
    Systolic_Mean = mean(Systolic_BP, na.rm = TRUE),
    Diastolic_Mean = mean(Diastolic_BP, na.rm = TRUE),
    Cholesterol_Mean = mean(Cholesterol_Level, na.rm = TRUE),
    .groups = "drop"
  )

site_summary
```

Each site was ranked based on its performance across the selected risk factors. Rankings were assigned in descending order, where higher values indicate greater risk. Tied values were given the average of their ranks. The ranking process covered dropout rate, adverse event rate, average systolic blood pressure, average diastolic blood pressure, and average cholesterol level.

```{r}
# Rank each metric
site_ranked <- site_summary %>%
  mutate(
    Dropout_Rank = rank(-Dropout_Rate, ties.method = "average", na.last = "keep"),
    AE_Rank = rank(-AE_Rate, ties.method = "average", na.last = "keep"),
    Systolic_Rank = rank(-Systolic_Mean, ties.method = "average", na.last = "keep"),
    Diastolic_Rank = rank(-Diastolic_Mean, ties.method = "average", na.last = "keep"),
    Cholesterol_Rank = rank(-Cholesterol_Mean, ties.method = "average", na.last = "keep")
  )

# Convert to long format
rank_long <- site_ranked %>%
  select(Site_ID, ends_with("_Rank")) %>%
  pivot_longer(
    cols = ends_with("_Rank"),
    names_to = "RF",
    values_to = "Rank_Value"
  ) %>%
  mutate(
    RF = case_when(
      RF == "Dropout_Rank" ~ "Dropout Rate",
      RF == "AE_Rank" ~ "Adverse Event Rate",
      RF == "Systolic_Rank" ~ "Average Systolic BP",
      RF == "Diastolic_Rank" ~ "Average Diastolic BP",
      RF == "Cholesterol_Rank" ~ "Average Cholesterol Level",
      TRUE ~ RF
    )
  )

rank_long
```

An overall rank was calculated for each site by averaging its ranks across all five risk factors. This average rank provides a composite indicator of site performance, allowing for a unified comparison of site-level data quality and reliability.

```{r}
# Compute average rank per site
avg_rank <- rank_long %>%
  group_by(Site_ID) %>%
  summarise(Rank_Value = mean(Rank_Value, na.rm = TRUE), .groups = "drop")

avg_rank
```

### K-means Clustering

To determine the optimal number of site clusters, the average silhouette width was calculated for K values ranging from 2 to 10. The silhouette method evaluates how well each site fits within its assigned cluster, with higher values indicating better cohesion and separation. The plot showed that $K=3$ yielded the highest average silhouette width, suggesting three distinct clusters best represent the variation in average site ranks.

```{r}
# K means clustering 
set.seed(117)
# Function to calculate average silhouette width
calculate_silhouette <- function(k) {
  kmeans_result <- kmeans(avg_rank$Rank_Value, centers = k, nstart = 10)
  sil <- silhouette(kmeans_result$cluster, dist(avg_rank$Rank_Value))
  mean(sil[, "sil_width"])
}

# Compute silhouette scores for k = 2 to 10
k_values <- 2:10
silhouette_scores <- sapply(k_values, calculate_silhouette)

# Create a data frame for plotting
sil_df <- data.frame(
  K = k_values,
  Silhouette = silhouette_scores
)

# Plot using ggplot2
ggplot(sil_df, aes(x = K, y = Silhouette)) +
  geom_line(linewidth = 1) +
  geom_point(color = "red", size = 3) +
  labs(
    title = "Silhouette Plot: Optimal Number of Clusters",
    x = "Number of Clusters (K)",
    y = "Average Silhouette Width"
  ) +
  scale_x_continuous(breaks = 2:10) +
  theme_bw()

```

```{r, warning=FALSE, message=FALSE}
# Run k-means
kmeans_result <- kmeans(avg_rank$Rank_Value, centers = 3, nstart = 10)

# Create a lookup table for cluster centers and risk labels
cluster_labels <- tibble(
  cluster = 1:3,
  center = as.numeric(kmeans_result$centers)) %>%
  arrange(desc(center)) %>%
  mutate(site_risk = c("Low", "Medium", "High"))

# Attach cluster and site_risk to avg_rank
avg_rank <- avg_rank %>%
  mutate(cluster = kmeans_result$cluster) %>%
  left_join(cluster_labels, by = "cluster")  

p <- ggplot(avg_rank, aes(x = Rank_Value, fill = factor(site_risk, levels = c("Low", "Medium", "High")))) +
  geom_histogram(binwidth = 2, alpha = 0.6, color = "black") +
  geom_vline(data = cluster_labels, aes(xintercept = center), 
             linetype = "dashed", color = "black", size = 1) +
  scale_fill_manual(values = c("High" = "red", "Medium" = "blue", "Low" = "forestgreen")) +
  labs(title = "K-Means Clustering on Average Rank",
       x = "Average Rank Value",
       y = "Number of Sites",
       fill = "Site Risk") +
  theme_bw() +
  theme(legend.position = "bottom")

```

Sites were clustered using k-means based on their average rank across risk factors, where higher ranks indicate better site performance. After clustering, risk labels were assigned in descending order of the cluster centers: the cluster with the highest average rank was labeled Low risk, followed by Medium, and the cluster with the lowest average rank labeled High risk.

Thus, Low-risk sites had the highest average ranks, suggesting consistently favorable performance across the ranked metrics. In contrast, High-risk sites had the lowest average ranks, indicating potential concerns such as underreporting, protocol non-adherence, or other data integrity issues

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-cap: "Histogram of average site rankings. Dashed vertical lines indicate k-means cluster centers used to assign site risk levels (Low, Medium, High)."
p
```

```{r}
df_with_risk <- df |>
  left_join(avg_rank |>
              select(Site_ID, site_risk),
            by = "Site_ID") 

rates_dat <- site_summary |>
  left_join(avg_rank |>
              select(site_risk, Site_ID),
            by = "Site_ID") |>
  pivot_longer(cols = 2:6,
               names_to = "RF",
               values_to = "Value") |>
  mutate(RF = case_when(
    RF == "Dropout_Rate" ~ "Dropout Rate",
    RF == "AE_Rate" ~ "Adverse Event Rate",
    RF == "Systolic_Mean" ~ "Average Systolic BP",
    RF == "Diastolic_Mean" ~ "Average Diastolic BP",
    RF == "Cholesterol_Mean" ~ "Average Cholesterol Level",
    TRUE ~ RF
  )) |> 
  mutate(site_risk = factor(site_risk, levels = c("Low", "Medium", "High")))
  

# Density Plots 

density_plots <- rates_dat %>%
  split(.$RF) %>%
  map(~ ggplot(.x, aes(x = Value, fill = site_risk)) +
        geom_density(alpha = 0.3, color = NA) +
        scale_fill_manual(values = c(
          "High" = "red", "Medium" = "blue", "Low" = "forestgreen"   
        )) +
        labs(
          x = unique(.x$RF),
          y = "Density",
          fill = "Site Risk"
        ) +
        theme_bw() +
        theme(
          legend.position = "bottom",
          legend.title = element_text(size = 14, face = "bold"),
          legend.text = element_text(size = 12),
          axis.text = element_text(size = 12, face = "bold"),
          axis.title = element_text(size = 14, face = "bold"),
          plot.title = element_blank()
        )
  ) 

```

### Distributional Analysis of Data Anomalies Using Risk Factors

**1. Dropout Rate**

Sites classified as high risk tend to have elevated dropout rates compared to medium and low risk sites. This pattern suggests possible engagement or operational issues at those sites, potentially affecting participant retention.

```{r}
#| echo: false
#| warning: false
#| message: false
density_plots[["Dropout Rate"]]
```

**2. Adverse Event Rate**

Adverse event rates are skewed higher for high risk sites, with some reporting unusually elevated rates. This could point to over-reporting, inconsistent AE definitions, or poor protocol adherence, which are often signs of unreliable data.

```{r}
#| echo: false
#| warning: false
#| message: false
density_plots[["Adverse Event Rate"]]
```

**3. Average Systolic BP**

High-risk sites report higher and more variable average systolic blood pressure levels. Although elevated BP is expected in this population, the degree of variation and inflation at high-risk sites may suggest inadequate blood pressure control, protocol non-adherence, or measurement inconsistencies. In contrast, lower-risk sites show more consistent and moderate readings, suggesting more reliable data capture.

```{r}
#| echo: false
#| warning: false
#| message: false
density_plots[["Average Systolic BP"]]
```

**4. Average Diastolic BP**

High-risk sites report higher and more variable average diastolic blood pressure readings. This wider spread may indicate inconsistent measurement techniques, protocol deviations, or site-level data quality concerns, similar to the systolic BP findings.

```{r}
#| echo: false
#| warning: false
#| message: false
density_plots[["Average Diastolic BP"]]
```

**5. Average Cholesterol Level**

Cholesterol levels appear elevated and right-shifted at high-risk sites compared to others. This pattern may indicate potential lab calibration issues, data entry errors, or differences in patient selection, such as enrolling individuals with higher baseline cardiovascular risk.

```{r}
#| echo: false
#| warning: false
#| message: false
density_plots[["Average Cholesterol Level"]]
```

```{r, warning=FALSE, message=FALSE, echo = F}
summary_statistics <- function(dsin,
                               numvars,
                               charvars = NULL,
                               by = NULL,
                               group = NULL,
                               mean_diffs = FALSE,
                               ci_diffs = FALSE,
                               pval_diffs = FALSE,
                               overall = FALSE,
                               fisher = FALSE,
                               digits_mean_sd = 2,
                               digits_median = 2,
                               digits_q1_q3 = 2,
                               digits_min_max = 2,
                               digits_diff_mean = 2,
                               digits_diff_ci = 2,
                               digits_diff_pval = 3,
                               welch = FALSE) {
  
  group_vars <- c(by, group)

  # Character Summary 
  char_summary <- NULL
  if (!is.null(charvars)) {
    char_summary <- dsin %>%
      tidyr::pivot_longer(cols = all_of(charvars), names_to = "charvar", values_to = "level") %>%
      dplyr::group_by(dplyr::across(all_of(group_vars)), charvar, level) %>%
      dplyr::summarise(n = dplyr::n(), .groups = "drop") %>%
      dplyr::group_by(dplyr::across(all_of(group_vars)), charvar) %>%
      dplyr::mutate(prop = sprintf("%d (%.0f%%)", n, 100 * n / sum(n))) %>%
      dplyr::ungroup()

    char_summary <- if (!is.null(group)) {
      char_summary %>%
        dplyr::transmute(
          !!by := !!rlang::sym(by),
          VARIABLE = charvar,
          STAT = level,
          VALUE = prop,
          STATORD = 1,
          VARTYPE = "character",
          !!group := !!rlang::sym(group)
        )
    } else {
      char_summary %>%
        dplyr::transmute(
          !!by := !!rlang::sym(by),
          VARIABLE = charvar,
          STAT = level,
          VALUE = prop,
          STATORD = 1,
          VARTYPE = "character"
        )
    }

    if (fisher && !is.null(by) && !is.null(group)) {
      fisher_pvals <- purrr::map_dfr(charvars, function(var) {
        tbl <- table(dsin[[var]], dsin[[group]])
        pval <- if (all(dim(tbl) > 1)) fisher.test(tbl)$p.value else NA
        tibble::tibble(
          !!by := unique(dsin[[by]]),
          VARIABLE = var,
          STAT = "Fisher P-value",
          STATORD = 2,
          VARTYPE = "character",
          VALUE = format.pval(pval, digits = digits_diff_pval, eps = 0.001)
        )
      })
      if (overall) {
        fisher_pvals <- fisher_pvals %>% dplyr::mutate(Overall = VALUE) %>% dplyr::select(-VALUE)
      } else if (!is.null(group)) {
        fisher_pvals <- fisher_pvals %>% dplyr::mutate(!!group := NA_character_)
      }
      char_summary <- dplyr::bind_rows(char_summary, fisher_pvals)
    }
  }

  summarize_numeric <- function(data, var) {
    v <- data[[var]]
    tibble::tibble(
      `N` = as.character(sum(!is.na(v))),
      `Mean (SD)` = sprintf(paste0("%.", digits_mean_sd, "f (%.", digits_mean_sd, "f)"),
                            mean(v, na.rm = TRUE), sd(v, na.rm = TRUE)),
      `Median` = sprintf(paste0("%.", digits_median, "f"), median(v, na.rm = TRUE)),
      `(Q1, Q3)` = sprintf(paste0("%.", digits_q1_q3, "f, %.", digits_q1_q3, "f"),
                           quantile(v, 0.25, na.rm = TRUE),
                           quantile(v, 0.75, na.rm = TRUE)),
      `Min, Max` = sprintf(paste0("%.", digits_min_max, "f, %.", digits_min_max, "f"),
                           min(v, na.rm = TRUE), max(v, na.rm = TRUE))
    )
  }

  numeric_summary <- purrr::map_dfr(numvars, function(var) {
    dsin %>%
      dplyr::group_by(dplyr::across(all_of(group_vars))) %>%
      dplyr::summarise(out = list(summarize_numeric(cur_data(), var)), .groups = "drop") %>%
      tidyr::unnest(out) %>%
      tidyr::pivot_longer(cols = c("N", "Mean (SD)", "Median", "(Q1, Q3)", "Min, Max"),
                          names_to = "STAT", values_to = "VALUE") %>%
      dplyr::mutate(
        !!by := !!rlang::sym(by),
        VARIABLE = var,
        STATORD = match(STAT, c("N", "Mean (SD)", "Median", "(Q1, Q3)", "Min, Max")),
        VARTYPE = "numeric"
      )
  })

  all_summary <- dplyr::bind_rows(char_summary, numeric_summary)

  if (!is.null(group)) {
    all_summary <- all_summary %>%
      tidyr::pivot_wider(names_from = all_of(group), values_from = VALUE)
  }

  if (!is.null(group) && overall) {
    overall_summary <- summary_statistics(
      dsin = dsin,
      numvars = numvars,
      charvars = charvars,
      by = by,
      group = NULL,
      mean_diffs = FALSE,
      ci_diffs = FALSE,
      pval_diffs = FALSE,
      overall = FALSE
    ) %>%
      dplyr::mutate(Overall = VALUE) %>% dplyr::select(-VALUE)

    all_summary <- dplyr::left_join(
      all_summary,
      overall_summary,
      by = c(by, "STAT", "VARIABLE", "STATORD", "VARTYPE")
    ) %>%
      dplyr::mutate(Overall = dplyr::coalesce(!!!dplyr::select(., dplyr::starts_with("Overall")))) %>%
      dplyr::select(-dplyr::starts_with("overall."))
  }

  if (mean_diffs && !is.null(group)) {
    levels <- levels(factor(dsin[[group]]))
    diff_results <- purrr::map_dfr(numvars, function(var) {
      tmp <- dsin %>% dplyr::filter(!is.na(.data[[var]]))
      if (length(levels) == 2) {
        test <- t.test(as.formula(paste(var, "~", group)), data = tmp, var.equal = !welch)
        lv <- levels
        diff_val <- test$estimate[2] - test$estimate[1]
        tibble::tibble(
          !!by := unique(tmp[[by]]),
          VARIABLE = var,
          STAT = c("Mean Difference", "95% CI of Difference", "Difference p-value"),
          STATORD = c(6, 7, 8),
          VARTYPE = "numeric",
          !!lv[1] := NA,
          !!lv[2] := c(
            sprintf(paste0("%.", digits_diff_mean, "f (%.", digits_diff_mean, "f)"),
                    diff_val, test$stderr),
            sprintf(paste0("%.", digits_diff_ci, "f, %.", digits_diff_ci, "f"),
                    test$conf.int[1], test$conf.int[2]),
            if (test$p.value < 0.001) "<0.001" else sprintf(paste0("%.", digits_diff_pval, "f"), test$p.value)
          )
        )
      } else {
        combs <- combn(levels, 2, simplify = FALSE)
        purrr::map_dfr(combs, function(lv) {
          subset <- tmp %>% dplyr::filter(.data[[group]] %in% lv)
          test <- t.test(as.formula(paste(var, "~", group)), data = subset, var.equal = !welch)
          stat <- sprintf("Mean Difference (%s - %s)", lv[2], lv[1])
          diff_val <- test$estimate[[lv[2]]] - test$estimate[[lv[1]]]
          val <- sprintf(paste0("%.", digits_diff_mean, "f (%.", digits_diff_mean, "f)"),
                         diff_val, test$stderr)
          ci <- sprintf(paste0("%.", digits_diff_ci, "f, %.", digits_diff_ci, "f"),
                        test$conf.int[1], test$conf.int[2])
          pval <- if (test$p.value < 0.001) "<0.001" else sprintf(paste0("%.", digits_diff_pval, "f"), test$p.value)
          tibble::tibble(
            !!by := unique(subset[[by]]),
            VARIABLE = var,
            STAT = c(stat, paste0("95% CI of ", stat), paste0("P-value of ", stat)),
            STATORD = 10,
            VARTYPE = "numeric",
            !!lv[1] := NA_character_,
            !!lv[2] := c(val, ci, pval)
          )
        })
      }
    })
    all_summary <- dplyr::bind_rows(all_summary, diff_results) 
  }

  return(all_summary %>% dplyr::arrange(VARTYPE, VARIABLE, STATORD) %>%
           dplyr::mutate(across(where(is.character), ~ if_else(is.na(.x), "", .x))))
}

rfs_data <- rank_long |>
  left_join(avg_rank |>
              select(site_risk, Site_ID),
            by = "Site_ID")
```

### Summary Statistics of Risk Factors

**High vs Low**

Low-risk sites had significantly higher rank values than high-risk sites for systolic blood pressure (mean difference = 24.83, p \< 0.001) and adverse event rate (mean difference = 19.79, p \< 0.001). These large and statistically significant differences suggest that low-risk sites are much more consistent in their reporting of expected clinical patterns or completeness. The lower ranks at high-risk sites point to potential underreporting or data quality issues that may compromise the reliability of the information collected at those locations.

```{r, warning=FALSE, message=FALSE}

# Create summary tables for  risk factor (RF)
# comparisons across site risk groups: High vs Low, Medium vs Low, High vs Medium
# Risk factors: High vs Low
rfs <- unique(rfs_data$RF)

hl_rfs <- map2_dfr(
  rfs,
  seq_along(rfs),
  function(rf, i) {
    tbl <- summary_statistics(
      dsin = rfs_data |> 
        filter(RF == rf, site_risk %in% c("High", "Low")) |> 
        mutate(site_risk = factor(site_risk, levels = c("High", "Low"))),
      numvars = "Rank_Value",
      by = "RF",
      group = "site_risk",
      mean_diffs = TRUE,
      ci_diffs = TRUE,
      pval_diffs = TRUE,
      overall = FALSE
    ) |>
      mutate(RF = if_else(STAT == "N", RF, "")) |>
      select(-c(VARIABLE, VARTYPE, STATORD))
    
    if (i < length(rfs)) {
      blank_row <- tbl[1, ] |> mutate(across(everything(), ~ ""))
      bind_rows(tbl, blank_row)
    } else {
      tbl
    }
  }
)

hl_rfs |> 
  gt() |> 
  cols_label(
    STAT = "Statistic",
    RF = "Risk Factor",
    Low = "Low Risk",
    High = "High Risk"
  ) |> 
  tab_caption("Comparison of Summary Statistics for Low and High Risk Sites") |>
  opt_table_font(font = list(gt::google_font("Roboto Condensed"), default_fonts())) |>
  opt_table_outline() |>
  opt_row_striping() |>
  tab_options(
    table.font.size = px(14),
    data_row.padding = px(4),
    heading.title.font.size = px(16),
    column_labels.font.weight = "bold",
    column_labels.background.color = "skyblue"
  )
```

**Medium vs Low**

Systolic blood pressure (mean difference = 16.14, p = 0.001) and dropout rate (mean difference = 12.08, p = 0.015) ranked significantly higher at low-risk sites than at medium-risk sites. This indicates that low-risk sites again show greater data completeness or capture clinical variation more accurately. Medium-risk sites may fall somewhere in between, with more plausible values than high-risk sites but still some signs of inconsistency or incompleteness.

```{r, warning=FALSE, message=FALSE}

# Risk factors: Medium vs Low
ml_rfs <- map2_dfr(
  rfs,
  seq_along(rfs),
  function(rf, i) {
    tbl <- summary_statistics(
      dsin = rfs_data |> 
        filter(RF == rf, site_risk %in% c("Medium", "Low")) |> 
        mutate(site_risk = factor(site_risk, levels = c("Medium", "Low"))),
      numvars = "Rank_Value",
      by = "RF",
      group = "site_risk",
      mean_diffs = TRUE,
      ci_diffs = TRUE,
      pval_diffs = TRUE,
      overall = FALSE
    ) |>
      mutate(RF = if_else(STAT == "N", RF, "")) |>
      select(-c(VARIABLE, VARTYPE, STATORD))
    
    if (i < length(rfs)) {
      blank_row <- tbl[1, ] |> mutate(across(everything(), ~ ""))
      bind_rows(tbl, blank_row)
    } else {
      tbl
    }
  }
)

ml_rfs |> 
  gt() |> 
  cols_label(
    STAT = "Statistic",
    RF = "Risk Factor",
    Low = "Low Risk",
    Medium = "Medium Risk"
  ) |> 
  tab_caption("Comparison of Summary Statistics for Low and Medium Risk Sites") |>
  opt_table_font(font = list(gt::google_font("Roboto Condensed"), default_fonts())) |>
  opt_table_outline() |>
  opt_row_striping() |>
  tab_options(
    table.font.size = px(14),
    data_row.padding = px(4),
    heading.title.font.size = px(16),
    column_labels.font.weight = "bold",
    column_labels.background.color = "skyblue"
  )
```

**Medium vs High**

Adverse event rate had a significant mean difference in ranks between medium-risk and high-risk sites (11.76, p = 0.017), favoring medium-risk sites. Although the differences in systolic and diastolic blood pressure ranks (8.69 and 7.73, respectively) were not statistically significant, they still suggest a trend toward more complete reporting at medium-risk sites compared to high-risk ones.

```{r, warning=FALSE, message=FALSE}
# Risk factors: High vs Medium
mh_rfs <- map2_dfr(
  rfs,
  seq_along(rfs),
  function(rf, i) {
    tbl <- summary_statistics(
      dsin = rfs_data |> 
        filter(RF == rf, site_risk %in% c("High", "Medium")) |> 
        mutate(site_risk = factor(site_risk, levels = c("High", "Medium"))),
      numvars = "Rank_Value",
      by = "RF",
      group = "site_risk",
      mean_diffs = TRUE,
      ci_diffs = TRUE,
      pval_diffs = TRUE,
      overall = FALSE
    ) |>
      mutate(RF = if_else(STAT == "N", RF, "")) |>
      select(-c(VARIABLE, VARTYPE, STATORD))
    
    if (i < length(rfs)) {
      blank_row <- tbl[1, ] |> mutate(across(everything(), ~ ""))
      bind_rows(tbl, blank_row)
    } else {
      tbl
    }
  }
)


mh_rfs |>
  gt() |>
  cols_label(
    STAT = "Statistic",
    RF = "Risk Factor",
    High = "High Risk",
    Medium = "Medium Risk"
  ) |>
  tab_caption("Comparison of Summary Statistics for Medium and High Risk Sites") |>
  opt_table_font(font = list(gt::google_font("Roboto Condensed"), default_fonts())) |>
  opt_table_outline() |>
  opt_row_striping() |>
  tab_options(
    table.font.size = px(14),
    data_row.padding = px(4),
    heading.title.font.size = px(16),
    column_labels.font.weight = "bold",
    column_labels.background.color = "skyblue"
  )
```

### Conclusion

The rank-based analysis demonstrates that low-risk sites consistently outperformed others in terms of data quality, achieving notably higher ranks across key clinical metrics. Medium-risk sites also performed better than high-risk sites, especially in the reporting of adverse events. These findings support the validity of the site classification and suggest that high-risk sites may be affected by protocol deviations, underreporting, or other operational issues that compromise data reliability.

### Recommendations

-   **Targeted monitoring** should be considered for high-risk sites to investigate possible causes of poor data quality.
-   **Site retraining or audits** may help reinforce protocol adherence and improve reporting accuracy.
-   **Continuous rank-based surveillance** can be incorporated into risk-based monitoring workflows to proactively flag emerging issues.
-   **Further investigation** into operational challenges at high-risk sites may offer insights to prevent similar issues in future trials.
